<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户咨询管理</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .admin-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: var(--card-background);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .data-table {
            background: var(--card-background);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .table-header {
            background: var(--secondary-color);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table-header h3 {
            color: var(--text-primary);
            font-size: 1.3rem;
            margin: 0;
        }
        
        .table-content {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }
        
        .table-row:last-child {
            border-bottom: none;
        }
        
        .table-row:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .table-header-row {
            background: var(--secondary-color);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .table-cell {
            color: var(--text-secondary);
        }
        
        .table-cell.name {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .table-cell.phone {
            font-family: monospace;
            color: var(--success-color);
        }
        
        .table-cell.time {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        .export-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-muted);
        }
        
        @media (max-width: 768px) {
            .table-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                padding: 1rem;
            }
            
            .table-header-row {
                display: none;
            }
            
            .table-cell {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .table-cell::before {
                content: attr(data-label) ": ";
                font-weight: 600;
                color: var(--text-primary);
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-users"></i> 用户咨询管理</h1>
            <p>查看和管理用户提交的咨询信息</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalInquiries">0</div>
                <div class="stat-label">总咨询数</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayInquiries">0</div>
                <div class="stat-label">今日咨询</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="thisWeekInquiries">0</div>
                <div class="stat-label">本周咨询</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="storageInfo">0 KB</div>
                <div class="stat-label">存储大小</div>
            </div>
        </div>
        
        <div class="data-table">
            <div class="table-header">
                <h3>咨询记录</h3>
            </div>
            <div class="table-content" id="inquiriesTable">
                <!-- 数据将通过JavaScript动态加载 -->
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <button class="export-btn" onclick="exportData()">
                <i class="fas fa-download"></i> 导出数据
            </button>
            <button class="export-btn" onclick="clearOldData()" style="background: #dc3545; margin-left: 1rem;">
                <i class="fas fa-trash"></i> 清理旧数据
            </button>
        </div>
    </div>

    <script>
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadInquiries();
        });
        
        // 格式化时间显示（北京时间）
        function formatTime(timestamp) {
            try {
                const time = new Date(timestamp);
                if (isNaN(time.getTime())) {
                    return '时间格式错误';
                }
                // 明确使用北京时间（UTC+8）
                return time.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false,
                    timeZone: 'Asia/Shanghai' // 明确指定北京时间
                });
            } catch (error) {
                return '时间格式错误';
            }
        }
        
        // 加载咨询数据
        function loadInquiries() {
            let inquiries = JSON.parse(localStorage.getItem('user_inquiries') || '[]');
            
            // 数据格式迁移：将旧的时间格式转换为ISO格式
            inquiries = inquiries.map(inquiry => {
                if (inquiry.timestamp && !inquiry.timestamp.includes('T')) {
                    // 旧格式，尝试转换为ISO格式
                    const oldTime = new Date(inquiry.timestamp);
                    if (!isNaN(oldTime.getTime())) {
                        inquiry.timestamp = oldTime.toISOString();
                    }
                }
                return inquiry;
            });
            
            // 保存迁移后的数据
            localStorage.setItem('user_inquiries', JSON.stringify(inquiries));
            
            displayInquiries(inquiries);
            updateStats(inquiries);
        }
        
        // 显示咨询数据
        function displayInquiries(inquiries) {
            const tableContent = document.getElementById('inquiriesTable');
            
            if (inquiries.length === 0) {
                tableContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>暂无咨询记录</h3>
                        <p>用户提交的咨询信息将显示在这里</p>
                    </div>
                `;
                return;
            }
            
            // 按时间倒序排列
            inquiries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let tableHTML = `
                <div class="table-row table-header-row">
                    <div class="table-cell">姓名</div>
                    <div class="table-cell">手机号</div>
                    <div class="table-cell">提交时间</div>
                    <div class="table-cell">操作</div>
                </div>
            `;
            
            inquiries.forEach((inquiry, index) => {
                const formattedTime = formatTime(inquiry.timestamp);
                
                tableHTML += `
                    <div class="table-row">
                        <div class="table-cell name" data-label="姓名">${inquiry.name}</div>
                        <div class="table-cell phone" data-label="手机号">${inquiry.phone}</div>
                        <div class="table-cell time" data-label="提交时间">${formattedTime}</div>
                        <div class="table-cell" data-label="操作">
                            <button onclick="copyPhone('${inquiry.phone}')" style="background: var(--success-color); color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                <i class="fas fa-copy"></i> 复制
                            </button>
                        </div>
                    </div>
                `;
            });
            
            tableContent.innerHTML = tableHTML;
        }
        
        // 更新统计信息
        function updateStats(inquiries) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const todayInquiries = inquiries.filter(inquiry => {
                try {
                    const inquiryTime = new Date(inquiry.timestamp);
                    return !isNaN(inquiryTime.getTime()) && inquiryTime >= today;
                } catch (error) {
                    return false;
                }
            }).length;
            
            const thisWeekInquiries = inquiries.filter(inquiry => {
                try {
                    const inquiryTime = new Date(inquiry.timestamp);
                    return !isNaN(inquiryTime.getTime()) && inquiryTime >= weekAgo;
                } catch (error) {
                    return false;
                }
            }).length;
            
            // 计算存储大小
            const dataSize = JSON.stringify(inquiries).length;
            const sizeInKB = (dataSize / 1024).toFixed(1);
            
            document.getElementById('totalInquiries').textContent = inquiries.length;
            document.getElementById('todayInquiries').textContent = todayInquiries;
            document.getElementById('thisWeekInquiries').textContent = thisWeekInquiries;
            document.getElementById('storageInfo').textContent = sizeInKB + ' KB';
        }
        
        // 复制手机号
        function copyPhone(phone) {
            navigator.clipboard.writeText(phone).then(() => {
                alert('手机号已复制到剪贴板！');
            }).catch(() => {
                // 备用方案
                const textArea = document.createElement('textarea');
                textArea.value = phone;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('手机号已复制到剪贴板！');
            });
        }
        
        // 导出数据
        function exportData() {
            const inquiries = JSON.parse(localStorage.getItem('user_inquiries') || '[]');
            
            if (inquiries.length === 0) {
                alert('暂无数据可导出！');
                return;
            }
            
            // 转换为CSV格式
            let csv = '姓名,手机号,提交时间\n';
            inquiries.forEach(inquiry => {
                const formattedTime = formatTime(inquiry.timestamp);
                csv += `"${inquiry.name}","${inquiry.phone}","${formattedTime}"\n`;
            });
            
            // 创建下载链接
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `用户咨询记录_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 清理旧数据
        function clearOldData() {
            const inquiries = JSON.parse(localStorage.getItem('user_inquiries') || '[]');
            const now = new Date();
            const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());

            const newInquiries = inquiries.filter(inquiry => {
                try {
                    const inquiryTime = new Date(inquiry.timestamp);
                    return !isNaN(inquiryTime.getTime()) && inquiryTime >= oneYearAgo;
                } catch (error) {
                    return false;
                }
            });

            if (newInquiries.length === inquiries.length) {
                alert('没有旧数据可以清理。');
                return;
            }

            localStorage.setItem('user_inquiries', JSON.stringify(newInquiries));
            alert('旧数据已清理！');
            loadInquiries(); // 重新加载数据以更新统计
        }
    </script>
</body>
</html> 